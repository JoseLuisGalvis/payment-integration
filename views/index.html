<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DEMO E-Commerce</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <nav
      id="navbar"
      class="navbar navbar-expand-lg navbar-light bg-light fixed-top"
    >
      <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="#">
          <img
            src="/images/logo.png"
            alt="Logo"
            style="width: 2em; margin-right: 1em"
          />
          CheckoutPro Store
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item"><a class="nav-link" href="#">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="#">Products</a></li>
            <li class="nav-item"><a class="nav-link" href="#">Contact</a></li>
          </ul>
          <div class="d-flex align-items-center">
            <button
              class="btn btn-outline-dark me-2"
              id="darkModeToggle"
              aria-label="Toggle dark mode"
            >
              <i class="bi bi-moon-stars"></i>
            </button>
            <div class="dropdown">
              <button
                class="btn btn-primary position-relative"
                id="cartButton"
                data-bs-toggle="dropdown"
                aria-label="Shopping cart"
              >
                <i class="bi bi-cart3"></i>
                <span
                  class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                  id="cartBadge"
                  >0</span
                >
              </button>
              <div
                class="dropdown-menu dropdown-menu-end p-3"
                style="min-width: 300px"
                id="cartDropdown"
              >
                <div class="cart-items text-muted" id="cartItemsContainer">
                  Your cart is empty
                </div>
                <div class="mt-3">
                  <strong>Total:</strong> <span id="cartTotal">$0.00</span>
                </div>
                <button class="btn btn-success w-100 mt-2">Checkout</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <main class="container min-vh-100 d-flex align-items-center mt-5 pt-5">
      <div class="row g-4">
        <div class="col-md-6 col-lg-3">
          <div
            class="card h-100"
            data-id="1001"
            data-description="Dispositivo de tienda móvil de comercio electrónico"
          >
            <img
              src="https://images.unsplash.com/photo-1523275335684-37898b6baf30"
              class="card-img-top w-100 object-fit-cover"
              alt="Smart Watch"
              style="height: 200px"
            />
            <div class="card-body">
              <h5 class="card-title">Smart Watch</h5>
              <p class="card-text">
                Premium smartwatch with health tracking features.
              </p>
              <div class="d-flex justify-content-between align-items-center">
                <span class="h5 mb-0">$19.00</span>
                <button class="btn btn-outline-primary dark-mode-btn">
                  Add to Cart
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-lg-3">
          <div
            class="card h-100"
            data-id="1002"
            data-description="Dispositivo de tienda móvil de comercio electrónico"
          >
            <img
              src="https://images.unsplash.com/photo-1505740420928-5e560c06d30e"
              class="card-img-top w-100 object-fit-cover"
              alt="Headphones"
              style="height: 200px"
            />
            <div class="card-body">
              <h5 class="card-title">Wireless Headphones</h5>
              <p class="card-text">High-quality noise-canceling headphones.</p>
              <div class="d-flex justify-content-between align-items-center">
                <span class="h5 mb-0">$15.00</span>
                <button class="btn btn-outline-primary dark-mode-btn">
                  Add to Cart
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-lg-3">
          <div
            class="card h-100"
            data-id="1003"
            data-description="Dispositivo de tienda móvil de comercio electrónico"
          >
            <img
              src="https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f"
              class="card-img-top w-100 object-fit-cover"
              alt="Camera"
              style="height: 200px"
            />
            <div class="card-body">
              <h5 class="card-title">Digital Camera</h5>
              <p class="card-text">Professional grade digital camera.</p>
              <div class="d-flex justify-content-between align-items-center">
                <span class="h5 mb-0">$29.00</span>
                <button class="btn btn-outline-primary dark-mode-btn">
                  Add to Cart
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-lg-3">
          <div
            class="card h-100"
            data-id="1004"
            data-description="Dispositivo de tienda móvil de comercio electrónico"
          >
            <img
              src="https://images.unsplash.com/photo-1511707171634-5f897ff02aa9"
              class="card-img-top w-100 object-fit-cover"
              alt="Smartphone"
              style="height: 200px"
            />
            <div class="card-body">
              <h5 class="card-title">Smartphone</h5>
              <p class="card-text">Latest model with advanced features.</p>
              <div class="d-flex justify-content-between align-items-center">
                <span class="h5 mb-0">$16.00</span>
                <button class="btn btn-outline-primary dark-mode-btn">
                  Add to Cart
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer id="footer" class="bg-light mt-5 py-4">
      <div class="container">
        <div class="row g-4">
          <div class="col-md-4">
            <img
              src="/images/logo.png"
              alt="Logo"
              class="about-logo mb-3"
              style="width: 4em"
            />
            <h5>About Us</h5>
            <p>Your trusted source for premium electronics and gadgets.</p>
          </div>

          <div class="col-md-4">
            <h5>Quick Links</h5>
            <ul class="list-unstyled">
              <li>
                <a href="#" class="text-decoration-none">Privacy Policy</a>
              </li>
              <li>
                <a href="#" class="text-decoration-none">Terms of Service</a>
              </li>
              <li><a href="#" class="text-decoration-none">Contact Us</a></li>
            </ul>
          </div>
          <div class="col-md-4">
            <h5>Newsletter</h5>
            <div class="input-group">
              <input
                type="email"
                class="form-control"
                placeholder="Enter your email"
              />
              <button class="btn btn-primary">Subscribe</button>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Cargar el SDK de Mercado Pago antes que cualquier código relacionado con él -->
    <script src="https://secure.mlstatic.com/sdk/javascript/v1/mercadopago.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/script.js"></script>

    <script>
      document
        .querySelector(".btn-success")
        .addEventListener("click", async () => {
          const items = cart.map((item) => ({
            name: item.name,
            price: item.price,
          }));

          try {
            const response = await fetch("/create-preference", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                items,
                external_reference: "jolugales@gmail.com",
              }),
            });

            const { init_point } = await response.json();

            // Validar que 'init_point' esté definido
            if (init_point) {
              window.location.href = init_point;
            } else {
              console.error(
                "Error: No se recibió un punto de inicialización válido"
              );
            }
          } catch (error) {
            console.error("Error:", error);
          }
        });
    </script>
  </body>
</html>
